---
title: "Results Analysis"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("main.R")
library(ggplot2)
```

First we will load the variables.
```{r}
cat(res$alpha)
cat(res$beta_home)
cat(res$beta_away)
cat(res$sigma_deficit)
cat(res$beta_intercept)
```

We can see the most important statistics in order:
```{r}
res$beta[order(res$beta, decreasing=T)]
res$beta[order(abs(res$beta), decreasing=T)]
```

Let us see who the best players are.
```{r}
player_mean_data$score <- res$player_value
players <- merge(players, player_mean_data[,c('playerId', 'score')])
players %>%
  arrange(desc(score)) %>%
  head(20)
```

We can also show the top 5 players by position:
```{r}
players %>%
  group_by(position) %>%
  slice_max(order_by=score, n=5) %>%
  select(c(displayName, position, score)) %>%
  print(n=50)
```

We can now try and apply this to the games in our dataset.
```{r}
ggplot(data.frame(Residual=stan_input$deficit-pred$deficits), aes(x=Residual)) +
  geom_histogram(aes(y=stat(density)), colour=1, fill="white", bins=10) +
  geom_density() +
  ggtitle("Residual Density Plot (Observed ELO)")
ggplot(data.frame(Residual=stan_input$deficit-pred$deficits_expc), aes(x=Residual)) +
  geom_histogram(aes(y=stat(density)), colour=1, fill="white", bins=10) +
  geom_density() +
  ggtitle("Residual Density Plot (Expected ELO)")
```

We can now try and apply this to compute win prediction accuracy.
```{r}
game_wins <- as.numeric(stan_input$deficit>0)
print( sum(game_wins==pred$wins)/length(game_wins) )
```

We can show the scores by origin:
```{r}
players %>%
  group_by(origin) %>%
  summarise (avg_score = mean(score), n_players=n()) %>%
  arrange(desc(avg_score)) %>%
  head(10) %>%
  print
```
